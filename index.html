<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“š</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <meta property="og:type" content="website">
    <meta property="og:title" content="í”„ë¡œì íŠ¸ ì—ë””í„° Pro">
    <meta property="og:description" content="ì—¬ëŸ¬ í˜ì´ì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í”„ë¡œì íŠ¸í˜• ì—ë””í„°">

    <title>í”„ë¡œì íŠ¸ ì—ë””í„° Pro</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: #f7f9fc; /* ë°°ê²½ìƒ‰ ì•½ê°„ ë” ì°¨ë¶„í•˜ê²Œ */
            margin: 0; padding: 0; height: 100vh; overflow: hidden; position: relative;
        }

        /* === ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ === */
        .sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: 260px; background-color: #fff;
            border-right: 1px solid #e0e0e0;
            z-index: 50;
            transform: translateX(-100%); /* ê¸°ë³¸ ìˆ¨ê¹€ */
            transition: transform 0.3s ease;
            display: flex; flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        .sidebar.open { transform: translateX(0); }

        .sidebar-header {
            padding: 20px; font-weight: bold; font-size: 18px; color: #333;
            border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;
        }
        .close-sidebar-btn { border: none; background: none; font-size: 20px; cursor: pointer; color: #888; }
        
        .page-list {
            flex: 1; overflow-y: auto; padding: 10px;
            list-style: none; margin: 0;
        }
        .page-item {
            padding: 10px 12px; margin-bottom: 4px; border-radius: 6px;
            cursor: pointer; font-size: 14px; color: #555;
            display: flex; justify-content: space-between; align-items: center;
            transition: background 0.2s;
        }
        .page-item:hover { background-color: #f1f3f5; }
        .page-item.active { background-color: #e3f2fd; color: #1565c0; font-weight: 600; }
        
        .page-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        .delete-page-btn {
            visibility: hidden; border: none; background: none; color: #ff5252;
            cursor: pointer; font-size: 16px; padding: 0 4px;
        }
        .page-item:hover .delete-page-btn { visibility: visible; }

        .sidebar-footer { padding: 15px; border-top: 1px solid #eee; }
        .add-page-btn {
            width: 100%; padding: 10px; background-color: #333; color: white;
            border: none; border-radius: 6px; cursor: pointer; font-size: 14px;
        }
        .add-page-btn:hover { background-color: #555; }

        /* === ë©”ì¸ ì˜ì—­ === */
        .main-content {
            height: 100%; transition: margin-left 0.3s ease;
            position: relative; background-color: white;
        }
        /* ì‚¬ì´ë“œë°” ì—´ë¦¬ë©´ ë©”ì¸ ì˜ì—­ ë°€ê¸° (PCì—ì„œë§Œ) */
        @media (min-width: 768px) {
            .sidebar.open + .main-content { margin-left: 260px; }
        }

        /* í–„ë²„ê±° ë²„íŠ¼ (ë©”ë‰´ ì—´ê¸°) */
        .menu-btn {
            position: absolute; top: 20px; left: 20px; z-index: 40;
            background: rgba(255,255,255,0.8); border: 1px solid #ddd;
            border-radius: 8px; padding: 8px 12px; cursor: pointer;
            font-size: 20px; color: #555; transition: all 0.2s;
        }
        .menu-btn:hover { background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

        /* ì—ë””í„° ìŠ¤íƒ€ì¼ */
        textarea, #markdownPreview {
            width: 100%; height: 100%; border: none; resize: none; outline: none;
            font-size: 17px; line-height: 1.8; color: #333;
            font-family: 'Pretendard', sans-serif;
            padding: 80px 50px 40px 50px; /* ìƒë‹¨ ì—¬ë°± ëŠ˜ë¦¼ (ë©”ë‰´ë²„íŠ¼ ë•Œë¬¸) */
            box-sizing: border-box; overflow-y: auto; background-color: transparent;
            position: absolute; top: 0; left: 0;
        }
        textarea { z-index: 10; }
        #markdownPreview { display: none; z-index: 20; background-color: white; }
        
        /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        #markdownPreview h1 { border-bottom: 1px solid #eee; padding-bottom: 0.3em; margin-top: 0; }
        #markdownPreview blockquote { border-left: 4px solid #ddd; padding-left: 1em; color: #666; margin: 1em 0; }
        #markdownPreview code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; }
        #markdownPreview pre { background: #f8f8f8; padding: 1em; border-radius: 8px; overflow-x: auto; }
        #markdownPreview img { max-width: 100%; border-radius: 8px; }

        /* === í”Œë¡œíŒ… íŒ¨ë„ (Tool Box) === */
        .floating-panel {
            position: absolute; top: 20px; right: 20px; width: 260px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.1); border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; z-index: 100;
            transition: opacity 0.3s;
        }
        .floating-panel.faded { opacity: 0.2; }
        .floating-panel:hover { opacity: 1 !important; }
        .panel-header {
            height: 28px; background-color: #f1f3f5; border-bottom: 1px solid #e9ecef;
            display: flex; align-items: center; justify-content: space-between; padding: 0 10px;
            cursor: grab; user-select: none;
        }
        .minimize-btn { border: none; background: none; cursor: pointer; color: #888; }
        .panel-content { padding: 12px; display: flex; flex-direction: column; gap: 10px; }
        .floating-panel.minimized .panel-content { display: none; }
        
        .panel-row { display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 4px; }
        .icon-btn {
            background: transparent; border: 1px solid transparent; cursor: pointer;
            padding: 6px; border-radius: 6px; color: #555;
            display: flex; align-items: center; justify-content: center;
        }
        .icon-btn:hover { background-color: rgba(0,0,0,0.05); }
        .icon-btn.active { background-color: #e3f2fd; color: #1565c0; border-color: #bbdefb; }
        .icon-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .sep { width: 1px; height: 14px; background: #ddd; margin: 0 4px; }

        .stats-info {
            font-size: 12px; color: #666; display: flex; flex-direction: column; gap: 4px;
            background-color: rgba(0,0,0,0.03); padding: 8px; border-radius: 8px;
        }
        .stat-line { display: flex; justify-content: space-between; }
        .token-text { color: #673ab7; font-weight: bold; }

        .toast {
            visibility: hidden; min-width: 200px; background-color: rgba(40, 40, 40, 0.95);
            color: #fff; text-align: center; border-radius: 50px; padding: 12px 24px;
            position: fixed; z-index: 1000; left: 50%; bottom: 40px; transform: translateX(-50%);
            opacity: 0; transition: opacity 0.3s, bottom 0.3s;
        }
        .toast.show { visibility: visible; opacity: 1; bottom: 60px; }
        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span>ğŸ—‚ï¸ í”„ë¡œì íŠ¸ í˜ì´ì§€</span>
            <button class="close-sidebar-btn" id="btnCloseSidebar">Ã—</button>
        </div>
        <ul class="page-list" id="pageList">
            </ul>
        <div class="sidebar-footer">
            <button class="add-page-btn" id="btnAddPage">+ ìƒˆ í˜ì´ì§€ ì¶”ê°€</button>
        </div>
    </div>

    <div class="main-content">
        <button class="menu-btn" id="btnMenu" title="í˜ì´ì§€ ëª©ë¡ ì—´ê¸°">â˜°</button>

        <div class="floating-panel" id="floatingPanel">
            <div class="panel-header" id="dragHandle">
                <span class="drag-label" style="font-size:11px; font-weight:bold; color:#888;">â ¿ Tool Box</span>
                <button class="minimize-btn" id="btnMinimize">_</button>
            </div>
            <div class="panel-content">
                <div class="panel-row">
                    <div class="btn-group">
                        <button class="icon-btn" id="btnSaveJson" title="ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥"><svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg></button>
                        <button class="icon-btn" id="btnLoadJson" title="í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°"><svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg></button>
                    </div>
                    <div class="sep"></div>
                    <div class="btn-group">
                        <button class="icon-btn" id="btnPreview" title="ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°"><svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg></button>
                    </div>
                    <div class="sep"></div>
                    <div class="btn-group">
                        <button class="icon-btn" id="btnUndo"><svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg></button>
                        <button class="icon-btn" id="btnRedo"><svg viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></svg></button>
                    </div>
                </div>
                <div class="stats-info">
                    <div class="stat-line"><span>AI í† í°</span><strong id="totalToken" class="token-text">0</strong></div>
                    <div class="stat-line"><span>ê¸€ììˆ˜</span><strong id="totalChar">0</strong></div>
                    <div class="stat-line" id="selectionRow" style="display:none; color:#1565c0;"><span>ì„ íƒ</span><strong id="selectChar">0</strong></div>
                </div>
            </div>
        </div>

        <input type="file" id="fileInput" accept=".json">
        <div id="markdownPreview"></div>
        <textarea id="textInput" placeholder="# ìƒˆ í˜ì´ì§€\n\në‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ì²« ë²ˆì§¸ ì¤„ì´ í˜ì´ì§€ ì œëª©ì´ ë©ë‹ˆë‹¤."></textarea>
    </div>
    
    <div id="toast" class="toast">ë©”ì‹œì§€</div>

<script>
    // === ì „ì—­ ë³€ìˆ˜ ===
    const textInput = document.getElementById('textInput');
    const markdownPreview = document.getElementById('markdownPreview');
    const toast = document.getElementById('toast');
    
    // ì‚¬ì´ë“œë°” ê´€ë ¨
    const sidebar = document.getElementById('sidebar');
    const btnMenu = document.getElementById('btnMenu');
    const btnCloseSidebar = document.getElementById('btnCloseSidebar');
    const pageListEl = document.getElementById('pageList');
    const btnAddPage = document.getElementById('btnAddPage');

    // ë°ì´í„° ìƒíƒœ ê´€ë¦¬
    let pages = [ { id: Date.now(), content: '' } ]; // í˜ì´ì§€ ë°°ì—´
    let currentPageIndex = 0; // í˜„ì¬ ë³´ê³  ìˆëŠ” í˜ì´ì§€
    
    const STORAGE_KEY = 'my_project_data_v2'; // í‚¤ ê°’ ë³€ê²½ (êµ¬ì¡°ê°€ ë°”ë€Œì–´ì„œ)

    // === 1. ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ ===
    window.addEventListener('load', () => {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
            try {
                const parsed = JSON.parse(savedData);
                // êµ¬ë²„ì „ ë°ì´í„°(ë‹¨ì¼ ë¬¸ìì—´) ì²˜ë¦¬
                if (parsed.content) { 
                    pages = [{ id: Date.now(), content: parsed.content }];
                } 
                // ì‹ ë²„ì „ ë°ì´í„°(í˜ì´ì§€ ë°°ì—´) ì²˜ë¦¬
                else if (Array.isArray(parsed)) {
                    pages = parsed;
                }
            } catch (e) { console.error('Data Load Error'); }
        }
        
        if(pages.length === 0) pages.push({ id: Date.now(), content: '' });
        
        renderSidebar();
        loadPage(0);
        
        // PC í™”ë©´ì´ë©´ ì‚¬ì´ë“œë°” ê¸°ë³¸ ì—´ê¸°
        if(window.innerWidth > 768) sidebar.classList.add('open');
    });

    // === 2. í˜ì´ì§€ ê´€ë¦¬ ë¡œì§ ===
    
    // í˜„ì¬ ì—ë””í„° ë‚´ìš©ì„ ë©”ëª¨ë¦¬(ë°°ì—´)ì— ì €ì¥
    function syncCurrentPage() {
        pages[currentPageIndex].content = textInput.value;
        updatePageTitleInSidebar(currentPageIndex);
    }

    // í™”ë©´ì— í˜ì´ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadPage(index) {
        // ê¸°ì¡´ í˜ì´ì§€ ë‚´ìš© ì €ì¥ ë¨¼ì € ìˆ˜í–‰
        pages[currentPageIndex].content = textInput.value;
        
        currentPageIndex = index;
        textInput.value = pages[index].content || '';
        
        // ë¯¸ë¦¬ë³´ê¸° ì¤‘ì´ì—ˆë‹¤ë©´ ê°±ì‹ 
        if (markdownPreview.style.display === 'block') {
            markdownPreview.innerHTML = marked.parse(textInput.value);
        }

        updateCounts();
        highlightActivePage();
    }

    // ìƒˆ í˜ì´ì§€ ì¶”ê°€
    btnAddPage.addEventListener('click', () => {
        // í˜„ì¬ ë‚´ìš© ì €ì¥
        syncCurrentPage();
        
        // ìƒˆ í˜ì´ì§€ ìƒì„±
        pages.push({ id: Date.now(), content: '' });
        
        // ì‚¬ì´ë“œë°” ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        renderSidebar();
        
        // ìƒˆ í˜ì´ì§€ë¡œ ì´ë™
        loadPage(pages.length - 1);
        
        // ëª¨ë°”ì¼ì´ë©´ ì¶”ê°€ í›„ ì‚¬ì´ë“œë°” ë‹«ê¸°
        if(window.innerWidth <= 768) sidebar.classList.remove('open');
        
        textInput.focus();
        showToast('ìƒˆ í˜ì´ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // í˜ì´ì§€ ì‚­ì œ
    function deletePage(index, e) {
        e.stopPropagation(); // ë¶€ëª¨ í´ë¦­ ë°©ì§€
        if (pages.length <= 1) return showToast('ìµœì†Œ í•œ ì¥ì€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.');
        if (!confirm('ì •ë§ ì´ í˜ì´ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        pages.splice(index, 1);
        
        // ì¸ë±ìŠ¤ ì¡°ì •
        if (currentPageIndex >= pages.length) currentPageIndex = pages.length - 1;
        
        renderSidebar();
        loadPage(currentPageIndex);
        saveContent(true);
        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì‚¬ì´ë“œë°” ë Œë”ë§ (ëª©ë¡ ê·¸ë¦¬ê¸°)
    function renderSidebar() {
        pageListEl.innerHTML = '';
        pages.forEach((page, idx) => {
            const li = document.createElement('li');
            li.className = 'page-item';
            if (idx === currentPageIndex) li.classList.add('active');
            
            // ì œëª© ì¶”ì¶œ (ì²« ì¤„)
            let title = (page.content || '').split('\n')[0].trim().replace(/^[#\s]+/, '');
            if (!title) title = `í˜ì´ì§€ ${idx + 1}`;

            li.innerHTML = `
                <span class="page-title">${title}</span>
                <button class="delete-page-btn" title="ì‚­ì œ">Ã—</button>
            `;
            
            // í´ë¦­ ì´ë²¤íŠ¸: í˜ì´ì§€ ì´ë™
            li.addEventListener('click', () => loadPage(idx));
            
            // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
            li.querySelector('.delete-page-btn').addEventListener('click', (e) => deletePage(idx, e));

            pageListEl.appendChild(li);
        });
    }

    // ì‚¬ì´ë“œë°” ì œëª©ë§Œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (íƒ€ì´í•‘ ì‹œ)
    function updatePageTitleInSidebar(index) {
        const items = pageListEl.querySelectorAll('.page-item');
        if(items[index]) {
            let title = (pages[index].content || '').split('\n')[0].trim().replace(/^[#\s]+/, '');
            if (!title) title = `í˜ì´ì§€ ${index + 1}`;
            items[index].querySelector('.page-title').textContent = title;
        }
    }
    
    function highlightActivePage() {
        const items = pageListEl.querySelectorAll('.page-item');
        items.forEach((item, idx) => {
            if (idx === currentPageIndex) item.classList.add('active');
            else item.classList.remove('active');
        });
    }


    // === 3. ì‚¬ì´ë“œë°” UI ì œì–´ ===
    btnMenu.addEventListener('click', () => sidebar.classList.add('open'));
    btnCloseSidebar.addEventListener('click', () => sidebar.classList.remove('open'));
    
    // === 4. ìë™ ì €ì¥ ë° JSON ì €ì¥ ===
    
    // ì…ë ¥ ê°ì§€
    textInput.addEventListener('input', () => {
        syncCurrentPage(); // ë°°ì—´ì— ì¦‰ì‹œ ë°˜ì˜
        updateCounts();
        saveContent(false); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
    });

    function saveContent(isAuto = false) {
        syncCurrentPage();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(pages));
        if(isAuto) showToast('ìë™ ì €ì¥ë¨');
    }

    // JSON íŒŒì¼ë¡œ ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥
    document.getElementById('btnSaveJson').addEventListener('click', () => {
        syncCurrentPage();
        const data = pages;
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const ts = new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");
        a.download = `Project_${ts}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        showToast('ì „ì²´ í”„ë¡œì íŠ¸ ì €ì¥ ì™„ë£Œ');
    });

    // ë¶ˆëŸ¬ì˜¤ê¸°
    const fileInput = document.getElementById('fileInput');
    document.getElementById('btnLoadJson').addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (!confirm("í˜„ì¬ í”„ë¡œì íŠ¸ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?")) { fileInput.value=''; return; }
        
        const reader = new FileReader();
        reader.onload = function(evt) {
            try {
                const data = JSON.parse(evt.target.result);
                if (Array.isArray(data)) {
                    pages = data;
                    currentPageIndex = 0;
                    renderSidebar();
                    loadPage(0);
                    saveContent(false);
                    showToast('í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ');
                } else {
                    alert('í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            } catch(e) { alert('íŒŒì¼ ì˜¤ë¥˜'); }
        };
        reader.readAsText(file); fileInput.value='';
    });


    // === 5. ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° (ë§ˆí¬ë‹¤ìš´, ë“œë˜ê·¸ ë“± ê¸°ì¡´ ê¸°ëŠ¥) ===
    
    // ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°
    const btnPreview = document.getElementById('btnPreview');
    btnPreview.addEventListener('click', () => {
        if (markdownPreview.style.display === 'none') {
            markdownPreview.innerHTML = marked.parse(textInput.value);
            textInput.style.display = 'none';
            markdownPreview.style.display = 'block';
            btnPreview.classList.add('active');
        } else {
            markdownPreview.style.display = 'none';
            textInput.style.display = 'block';
            btnPreview.classList.remove('active');
            textInput.focus();
        }
    });

    // íŒ¨ë„ ë“œë˜ê·¸
    const panel = document.getElementById('floatingPanel');
    const dragHandle = document.getElementById('dragHandle');
    let isDragging = false, startX, startY, initLeft, initTop;
    
    function startDrag(e) {
        if(e.target.closest('.minimize-btn')) return;
        isDragging=true;
        const cx = e.type.includes('touch')?e.touches[0].clientX:e.clientX;
        const cy = e.type.includes('touch')?e.touches[0].clientY:e.clientY;
        const r = panel.getBoundingClientRect();
        panel.style.right='auto'; panel.style.left=r.left+'px'; panel.style.top=r.top+'px';
        startX=cx; startY=cy; initLeft=r.left; initTop=r.top;
    }
    function doDrag(e) {
        if(!isDragging) return; e.preventDefault();
        const cx = e.type.includes('touch')?e.touches[0].clientX:e.clientX;
        const cy = e.type.includes('touch')?e.touches[0].clientY:e.clientY;
        panel.style.left=(initLeft+(cx-startX))+'px';
        panel.style.top=(initTop+(cy-startY))+'px';
    }
    dragHandle.addEventListener('mousedown', startDrag); document.addEventListener('mousemove', doDrag); document.addEventListener('mouseup', ()=>{isDragging=false});
    dragHandle.addEventListener('touchstart', startDrag, {passive:false}); document.addEventListener('touchmove', doDrag, {passive:false}); document.addEventListener('touchend', ()=>{isDragging=false});

    // íŒ¨ë„ ì ‘ê¸°
    document.getElementById('btnMinimize').addEventListener('click', () => {
        panel.classList.toggle('minimized');
    });

    // Undo/Redo
    document.getElementById('btnUndo').addEventListener('click', () => { document.execCommand('undo'); });
    document.getElementById('btnRedo').addEventListener('click', () => { document.execCommand('redo'); });

    // í† í°/ê¸€ììˆ˜ ê³„ì‚°
    function estimateTokens(text) { 
        if(!text) return 0;
        const cjk = (text.match(/[\u3131-\uD79D\uAC00-\uD7A3\u4E00-\u9FFF]/g)||[]).length;
        return Math.ceil((cjk*1.1)+((text.length-cjk)*0.25));
    }
    function updateCounts() {
        const t = textInput.value;
        document.getElementById('totalToken').textContent = estimateTokens(t).toLocaleString();
        document.getElementById('totalChar').textContent = t.length.toLocaleString();
    }

    // ìœ í‹¸: í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(msg) {
        toast.textContent = msg; toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    }
    
    // ìë™ ì €ì¥ íƒ€ì´ë¨¸
    setInterval(() => saveContent(true), 180000);

</script>
</body>
</html>
