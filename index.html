<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <meta property="og:type" content="website">
    <meta property="og:title" content="ê¸€ììˆ˜ì„¸ê¸° Pro (Markdown)">
    <meta property="og:description" content="ë§ˆí¬ë‹¤ìš´ ì§€ì› ì—ë””í„°">
    <meta property="og:image" content="thumb.png">

    <title>ê¸€ììˆ˜ì„¸ê¸° Pro (MD)</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* === ì—ë””í„° & í”„ë¦¬ë·° ê³µí†µ ìŠ¤íƒ€ì¼ === */
        textarea, #markdownPreview {
            width: 100%;
            height: 100%;
            border: none;
            resize: none;
            outline: none;
            font-size: 17px; 
            line-height: 1.8;
            color: #333;
            font-family: 'Pretendard', sans-serif;
            padding: 40px 50px; 
            box-sizing: border-box;
            overflow-y: auto;
            background-color: transparent;
            position: absolute; /* ê²¹ì¹˜ê²Œ ë°°ì¹˜ */
            top: 0;
            left: 0;
        }

        textarea { z-index: 10; } /* ê¸°ë³¸ì€ ì—ë””í„°ê°€ ìœ„ */
        
        textarea::-webkit-scrollbar, #markdownPreview::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track, #markdownPreview::-webkit-scrollbar-track { background: transparent; }
        textarea::-webkit-scrollbar-thumb, #markdownPreview::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 4px; }

        /* === ë§ˆí¬ë‹¤ìš´ í”„ë¦¬ë·° ìŠ¤íƒ€ì¼ === */
        #markdownPreview {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            z-index: 20;   /* í™œì„±í™” ì‹œ ì—ë””í„°ë³´ë‹¤ ìœ„ */
            background-color: white; /* ë°°ê²½ìƒ‰ í•„ìˆ˜ */
        }
        
        /* ë§ˆí¬ë‹¤ìš´ ìš”ì†Œë³„ ë””ìì¸ */
        #markdownPreview h1, #markdownPreview h2, #markdownPreview h3 { border-bottom: 1px solid #eee; padding-bottom: 0.3em; margin-top: 1.5em; }
        #markdownPreview h1 { font-size: 2em; }
        #markdownPreview h2 { font-size: 1.5em; }
        #markdownPreview blockquote { border-left: 4px solid #ddd; padding-left: 1em; color: #666; margin: 1em 0; }
        #markdownPreview code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
        #markdownPreview pre { background: #f8f8f8; padding: 1em; border-radius: 8px; overflow-x: auto; }
        #markdownPreview pre code { background: none; padding: 0; }
        #markdownPreview img { max-width: 100%; border-radius: 8px; }
        #markdownPreview ul, #markdownPreview ol { padding-left: 1.5em; }
        #markdownPreview a { color: #0366d6; text-decoration: none; }
        #markdownPreview a:hover { text-decoration: underline; }
        #markdownPreview hr { border: none; border-top: 2px solid #eee; margin: 2em 0; }

        /* === í”Œë¡œíŒ… íŒ¨ë„ ìŠ¤íƒ€ì¼ === */
        .floating-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 260px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            z-index: 100; /* ìµœìƒë‹¨ ìœ ì§€ */
            transition: opacity 0.3s ease, height 0.3s ease;
            overflow: hidden;
        }

        .floating-panel.faded { opacity: 0.2; }
        .floating-panel:hover { opacity: 1 !important; }

        .panel-header {
            height: 28px;
            background-color: #f1f3f5;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            cursor: grab;
            user-select: none;
        }
        .panel-header:active { cursor: grabbing; }

        .drag-label { font-size: 11px; font-weight: bold; color: #888; display: flex; align-items: center; gap: 5px; }
        .minimize-btn { border: none; background: none; font-size: 18px; line-height: 1; color: #888; cursor: pointer; padding: 0 5px; }
        .minimize-btn:hover { color: #333; }

        .panel-content { padding: 12px; display: flex; flex-direction: column; gap: 10px; }
        .floating-panel.minimized { height: 28px; width: 120px; opacity: 0.7; }
        .floating-panel.minimized .panel-content { display: none; }

        .panel-row { display: flex; justify-content: space-between; align-items: center; }
        .btn-group { display: flex; gap: 4px; }
        .icon-btn {
            background: transparent; border: 1px solid transparent; cursor: pointer;
            padding: 6px; border-radius: 6px; color: #555;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .icon-btn:hover { background-color: rgba(0,0,0,0.05); color: #000; }
        .icon-btn:active { transform: translateY(1px); }
        .icon-btn.active { background-color: #e3f2fd; color: #1565c0; border-color: #bbdefb; } /* í™œì„±í™” ìƒíƒœ */
        .icon-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .sep { width: 1px; height: 14px; background: #ddd; margin: 0 4px; }

        .stats-info {
            font-size: 12px; color: #666; display: flex; flex-direction: column; gap: 4px;
            background-color: rgba(0,0,0,0.03); padding: 8px; border-radius: 8px;
        }
        .stat-line { display: flex; justify-content: space-between; }
        .stat-line strong { color: #333; }
        .token-text { color: #673ab7; }

        .symbol-palette {
            display: none; grid-template-columns: repeat(6, 1fr); gap: 4px;
            background-color: #f8f9fa; padding: 8px; border-radius: 8px;
            margin-top: 5px; border: 1px solid #eee;
        }
        .symbol-palette.show { display: grid; }
        .sym-btn {
            background: #fff; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;
            padding: 6px 0; font-size: 14px; text-align: center; color: #333; transition: background 0.2s;
        }
        .sym-btn:hover { background-color: #e3f2fd; border-color: #90caf9; }

        .toast {
            visibility: hidden; min-width: 200px; background-color: rgba(40, 40, 40, 0.95);
            color: #fff; text-align: center; border-radius: 50px; padding: 12px 24px;
            position: fixed; z-index: 1000; left: 50%; bottom: 40px; transform: translateX(-50%);
            font-size: 14px; font-weight: 500; opacity: 0; transition: opacity 0.3s, bottom 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .toast.show { visibility: visible; opacity: 1; bottom: 60px; }
        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="floating-panel" id="floatingPanel">
        
        <div class="panel-header" id="dragHandle">
            <span class="drag-label">â ¿ Tool Box</span>
            <button class="minimize-btn" id="btnMinimize" title="ì ‘ê¸°/í´ê¸°">_</button>
        </div>

        <div class="panel-content">
            <div class="panel-row">
                <div class="btn-group">
                    <button class="icon-btn" id="btnSaveJson" title="ì €ì¥"><svg viewBox="0 0 24 24"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg></button>
                    <button class="icon-btn" id="btnLoadJson" title="ë¶ˆëŸ¬ì˜¤ê¸°"><svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg></button>
                </div>
                <div class="sep"></div>
                <div class="btn-group">
                    <button class="icon-btn" id="btnPreview" title="ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°">
                        <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                    </button>
                    <button class="icon-btn" id="btnSymbol" title="íŠ¹ìˆ˜ë¬¸ì">
                        <svg viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    </button>
                </div>
                <div class="sep"></div>
                <div class="btn-group">
                    <button class="icon-btn" id="btnUndo"><svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg></button>
                    <button class="icon-btn" id="btnRedo"><svg viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></svg></button>
                </div>
            </div>

            <div class="symbol-palette" id="symbolPalette"></div>

            <div class="stats-info">
                <div class="stat-line"><span>AI í† í°</span><strong id="totalToken" class="token-text">0</strong></div>
                <div class="stat-line"><span>ê¸€ììˆ˜</span><strong id="totalChar">0</strong></div>
                <div class="stat-line" id="selectionRow" style="display:none; color:#1565c0;"><span>ì„ íƒ</span><strong id="selectChar">0</strong></div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json">
    
    <div id="markdownPreview"></div>
    
    <textarea id="textInput" placeholder="[ë§ˆí¬ë‹¤ìš´ ì§€ì›]
# ì œëª© 1
## ì œëª© 2
- ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ
**êµµì€ ê¸€ì”¨**

ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”... (íŒ¨ë„ ìƒë‹¨ì„ ì¡ì•„ ëŒë©´ ì´ë™í•©ë‹ˆë‹¤)"></textarea>
    
    <div id="toast" class="toast">ë©”ì‹œì§€</div>

<script>
    const textInput = document.getElementById('textInput');
    const markdownPreview = document.getElementById('markdownPreview');
    const symbolPalette = document.getElementById('symbolPalette');
    const toast = document.getElementById('toast');
    const panel = document.getElementById('floatingPanel');
    const dragHandle = document.getElementById('dragHandle');
    const btnMinimize = document.getElementById('btnMinimize');
    const btnPreview = document.getElementById('btnPreview');
    const STORAGE_KEY = 'my_editor_content_v1';

    // === 1. ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ===
    let isPreviewMode = false;

    btnPreview.addEventListener('click', () => {
        if (!isPreviewMode) {
            // ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ í™œì„±í™” (Text -> HTML ë³€í™˜)
            const mdText = textInput.value;
            // marked ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ë³€í™˜
            markdownPreview.innerHTML = marked.parse(mdText);
            
            textInput.style.display = 'none';
            markdownPreview.style.display = 'block';
            
            btnPreview.classList.add('active'); // ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½
            showToast('ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ');
        } else {
            // í¸ì§‘ ëª¨ë“œë¡œ ëŒì•„ì˜¤ê¸°
            markdownPreview.style.display = 'none';
            textInput.style.display = 'block';
            
            btnPreview.classList.remove('active');
            textInput.focus();
        }
        isPreviewMode = !isPreviewMode;
    });

    // === 2. ë“œë˜ê·¸ ê¸°ëŠ¥ ===
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;

    function startDrag(e) {
        if (e.target.closest('.minimize-btn')) return;
        
        isDragging = true;
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        const rect = panel.getBoundingClientRect();
        panel.style.right = 'auto';
        panel.style.bottom = 'auto';
        panel.style.left = rect.left + 'px';
        panel.style.top = rect.top + 'px';

        startX = clientX;
        startY = clientY;
        initialLeft = rect.left;
        initialTop = rect.top;
    }

    function doDrag(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        const dx = clientX - startX;
        const dy = clientY - startY;

        panel.style.left = (initialLeft + dx) + 'px';
        panel.style.top = (initialTop + dy) + 'px';
    }

    function endDrag() { isDragging = false; }

    dragHandle.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', doDrag);
    document.addEventListener('mouseup', endDrag);

    dragHandle.addEventListener('touchstart', startDrag, {passive: false});
    document.addEventListener('touchmove', doDrag, {passive: false});
    document.addEventListener('touchend', endDrag);

    // === 3. íŒ¨ë„ ì œì–´ & ìë™ ì €ì¥ ===
    textInput.addEventListener('input', () => {
        panel.classList.add('faded');
        updateCounts();
        saveContent(false);
    });

    let typeTimer;
    textInput.addEventListener('keyup', () => {
        clearTimeout(typeTimer);
        typeTimer = setTimeout(() => { panel.classList.remove('faded'); }, 800);
    });

    btnMinimize.addEventListener('click', () => {
        panel.classList.toggle('minimized');
        btnMinimize.textContent = panel.classList.contains('minimized') ? 'â–¡' : '_';
    });

    // === 4. íŠ¹ìˆ˜ë¬¸ì & íˆ´ ===
    const symbols = [
        '# ', '- ', '**', '>', '```', '[]()', 
        'ğŸ¤«', 'â†’', 'â†', 'âŒ', 'âœ…', 'âš ï¸', 
        'ã€Œ', 'ã€', 'ã€', 'ã€', 'Ã—', 'Ã·'
    ];
    // ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ë„ ì‹¬ë³¼ì— ì¼ë¶€ ì¶”ê°€í•¨
    symbols.forEach(char => {
        const btn = document.createElement('button');
        btn.className = 'sym-btn'; btn.textContent = char;
        btn.onclick = () => insertSymbol(char);
        symbolPalette.appendChild(btn);
    });
    
    document.getElementById('btnSymbol').addEventListener('click', () => {
        if(panel.classList.contains('minimized')) return;
        symbolPalette.classList.toggle('show');
    });

    function insertSymbol(char) {
        if(isPreviewMode) return showToast('í¸ì§‘ ëª¨ë“œì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        const start = textInput.selectionStart; const end = textInput.selectionEnd;
        const text = textInput.value;
        textInput.value = text.substring(0, start) + char + text.substring(end);
        textInput.selectionStart = textInput.selectionEnd = start + char.length;
        textInput.focus(); updateCounts(); saveContent(false);
    }

    function showToast(msg) {
        toast.textContent = msg; toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2500);
    }

    document.getElementById('btnSaveJson').addEventListener('click', () => {
        if (!textInput.value) return showToast('ë‚´ìš© ì—†ìŒ');
        const data = { content: textInput.value, savedAt: new Date().toLocaleString() };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        const ts = new Date().toISOString().slice(0,19).replace(/[-T:]/g,"");
        a.download = `backup_${ts}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        showToast('ì €ì¥ ì™„ë£Œ');
    });

    const fileInput = document.getElementById('fileInput');
    document.getElementById('btnLoadJson').addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (textInput.value.trim() && !confirm("ë‚´ìš©ì´ ëŒ€ì²´ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { fileInput.value=''; return; }
        const reader = new FileReader();
        reader.onload = function(evt) {
            try {
                const data = JSON.parse(evt.target.result);
                if(data.content !== undefined) {
                    textInput.value = data.content;
                    updateCounts(); saveContent(false); showToast('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
                } else alert('í˜•ì‹ ì˜¤ë¥˜');
            } catch(e) { alert('íŒŒì¼ ì˜¤ë¥˜'); }
        };
        reader.readAsText(file); fileInput.value='';
    });

    document.getElementById('btnUndo').addEventListener('click', () => { 
        if(isPreviewMode) return;
        document.execCommand('undo'); textInput.focus(); 
    });
    document.getElementById('btnRedo').addEventListener('click', () => { 
        if(isPreviewMode) return;
        document.execCommand('redo'); textInput.focus(); 
    });

    function saveContent(isAuto = false) { localStorage.setItem(STORAGE_KEY, textInput.value); if(isAuto) showToast('ìë™ ì €ì¥ë¨'); }
    function estimateTokens(text) { 
        if(!text) return 0;
        const cjk = (text.match(/[\u3131-\uD79D\uAC00-\uD7A3\u4E00-\u9FFF]/g)||[]).length;
        return Math.ceil((cjk*1.1)+((text.length-cjk)*0.25));
    }
    function updateCounts() {
        const t = textInput.value;
        document.getElementById('totalToken').textContent = estimateTokens(t).toLocaleString();
        document.getElementById('totalChar').textContent = t.length.toLocaleString();
        const s = textInput.selectionStart, e = textInput.selectionEnd;
        const row = document.getElementById('selectionRow');
        if(e>s) { row.style.display='flex'; document.getElementById('selectChar').textContent=(e-s).toLocaleString(); }
        else row.style.display='none';
    }

    window.addEventListener('load', () => { 
        const s = localStorage.getItem(STORAGE_KEY); 
        if(s) { textInput.value=s; updateCounts(); showToast('ë³µêµ¬ ì™„ë£Œ'); }
    });
    setInterval(() => { if(textInput.value && !isPreviewMode) saveContent(true); }, 180000);
    window.addEventListener('beforeunload', () => saveContent(false));
    ['input','click','mouseup','keyup'].forEach(ev => textInput.addEventListener(ev, updateCounts));

</script>
</body>
</html>
